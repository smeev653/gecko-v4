####################
# General
####################

X_improve_ruler_stats_effect = {
	[[adm]
		add_stat_or_monarch_power = {
			stat = adm
			amount = $adm_amount$
		}
	]
	[[dip]
		add_stat_or_monarch_power = {
			stat = dip
			amount = $dip_amount$
		}
	]
	[[mil]
		add_stat_or_monarch_power = {
			stat = mil
			amount = $mil_amount$
		}
	]
	[[all]
		X_improve_ruler_stats_effect = {
			adm = yes dip = yes mil = yes 
			adm_amount = $all_amount$
			dip_amount = $all_amount$
			mil_amount = $all_amount$
		}
	]
}

X_on_development_effect = {
	X_province_estates_on_development_effect = { development = yes estate = estate_church }
	X_province_estates_on_development_effect = { development = yes estate = estate_burghers }
	X_province_estates_on_development_effect = { development = yes estate = estate_nobles }
	X_province_estates_on_development_effect = { development = yes estate = estate_dhimmi }
}

X_on_exploited_effect = {
	X_province_estates_on_development_effect = { exploited = yes estate = estate_church }
	X_province_estates_on_development_effect = { exploited = yes estate = estate_burghers }
	X_province_estates_on_development_effect = { exploited = yes estate = estate_nobles }
	X_province_estates_on_development_effect = { exploited = yes estate = estate_dhimmi }
}

X_on_estate_removed_effect = {
	X_province_estates_on_estate_removed_effect = { estate = estate_church }
	X_province_estates_on_estate_removed_effect = { estate = estate_burghers }
	X_province_estates_on_estate_removed_effect = { estate = estate_nobles }
	X_province_estates_on_estate_removed_effect = { estate = estate_dhimmi }
}

X_on_capital_moved_effect = {
	X_province_estates_on_capital_moved_effect = yes
}

X_on_province_owner_change_pmod_effect = {
	if = { 
		limit = {
			has_fort_building_trigger = yes
			X_flatland_terrain_trigger = yes
		}
		add_province_modifier = {
			name = X_flatland_fort_bonus_pmod
			duration = -1
			hidden = yes
		}
	}
	else = {
		limit = {
			has_province_modifier = X_flatland_fort_bonus_pmod
			OR = {
				X_flatland_terrain_trigger = no
				has_fort_building_trigger = no
			}
		}
		remove_province_modifier = X_flatland_fort_bonus_pmod
	}
	####################
	# Legacy Reforms
	####################
	if = {
		limit = {
			has_terrain = steppe
			owner = { 
				is_emperor_of_china = yes
				check_variable = {
					which = X_CRI_celestial_empire_reforms_variable
					value = 3
				}
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = X_CRI_reform_3_pmod }
			}
			add_province_modifier = {
				name = X_CRI_reform_3_pmod
				duration = -1
			}
		}
	}
	else = {
		limit = {
			OR = {
				NOT = { has_terrain = steppe }
				owner = {
					OR = {
						is_emperor_of_china = no
						NOT = { 
							check_variable = {
								which = X_CRI_celestial_empire_reforms_variable
								value = 3
							}
						}
					}
				}
			}
		}
		if = {
			limit = { has_province_modifier = X_CRI_reform_3_pmod }
			remove_province_modifier = X_CRI_reform_3_pmod
		}
	}
	if = {
		limit = {
			religion_group = christian
			owner = { 
				is_emperor_of_china = yes
				check_variable = {
					which = X_CRI_celestial_empire_reforms_variable
					value = 6
				}
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = X_CRI_reform_6_pmod }
			}
			add_province_modifier = {
				name = X_CRI_reform_6_pmod
				duration = -1
			}
		}
	}
	else = {
		limit = {
			OR = {
				NOT = { has_terrain = steppe }
				owner = {
					OR = {
						is_emperor_of_china = no
						NOT = { 
							check_variable = {
								which = X_CRI_celestial_empire_reforms_variable
								value = 6
							}
						}
					}
				}
			}
		}
		if = {
			limit = { has_province_modifier = X_CRI_reform_6_pmod }
			remove_province_modifier = X_CRI_reform_6_pmod
		}
	}
	####################
	# Estates
	####################
	if = {
		limit = {
			OR = {
				has_terrain = steppe
				AND = {
					region = ruthenia_region
					OR = {
						has_terrain = farmlands
						has_terrain = grasslands
					}
				}
			}
			has_fort_building_trigger = yes
			owner = { has_estate_privilege = X_estate_cossacks_privilege_1 }
			NOT = { has_province_modifier = X_estate_cossacks_privilege_1_pmod }
		}
		add_province_modifier = {
			name = X_estate_cossacks_privilege_1_pmod
			duration = -1
		}
	}
	else = {
		limit = {
			OR = {
				has_terrain = steppe
				AND = {
					region = ruthenia_region
					OR = {
						has_terrain = farmlands
						has_terrain = grasslands
					}
				}
			}
			OR = {
				has_fort_building_trigger = no
				owner = { NOT = { has_estate_privilege = X_estate_cossacks_privilege_1 } }
			}
			has_province_modifier = X_estate_cossacks_privilege_1_pmod
		}
		remove_province_modifier = X_estate_cossacks_privilege_1_pmod
	}
	if = {
		limit = {
			trade_goods = slaves
			owner = { has_estate_privilege = X_estate_burghers_privilege_1 }
			NOT = { has_province_modifier = X_estate_burghers_privilege_1_pmod }
		}
		add_province_modifier = {
			name = X_estate_burghers_privilege_1_pmod
			duration = -1
		}
	}
	else = {
		limit = {
			trade_goods = slaves
			owner = { NOT = { has_estate_privilege = X_estate_burghers_privilege_1 } }
			has_province_modifier = X_estate_burghers_privilege_1_pmod
		}
		remove_province_modifier = X_estate_burghers_privilege_1_pmod
	}
	####################
	# Province Estates
	####################
	if = {
		limit = {
			X_province_estates_has_pmod_trigger = yes
		}
		X_province_estates_remove_all_pmod_effect = yes
	}
}

####################
# Expand Infrastructure & Province Estates
####################
X_expand_infrastructure_remove_all_pmod_effect = {
	remove_province_modifier = X_expand_infrastructure_tier_1_pmod
	remove_province_modifier = X_expand_infrastructure_tier_2_pmod
	remove_province_modifier = X_expand_infrastructure_tier_3_pmod
	remove_province_modifier = X_expand_infrastructure_tier_4_pmod
	remove_province_modifier = X_expand_infrastructure_tier_5_pmod
	remove_province_modifier = X_expand_infrastructure_tier_6_pmod
	remove_province_modifier = X_expand_infrastructure_tier_7_pmod
	remove_province_modifier = X_expand_infrastructure_tier_8_pmod
	remove_province_modifier = X_expand_infrastructure_tier_9_pmod
	remove_province_modifier = X_expand_infrastructure_tier_10_pmod
}

X_province_estates_num_of_estate_provinces_effect = {
	if = {
		limit = { has_estate = $estate$ }
		hidden_effect = {
			set_variable = {
				which = X_province_estates_num_of_$estate$_provinces_variable
				value = 0
			}
			every_owned_province = {
				limit = { has_province_modifier = X_$estate$_province_control_pmod }
				set_variable = {
					which = X_province_estates_num_of_$estate$_provinces_variable
					value = 1
				}
				PREV = {
					change_variable = {
						which = X_province_estates_num_of_$estate$_provinces_variable
						which = PREV
					}
				}
			}
		}
	}
}

X_province_estates_on_capital_moved_effect = { 
	if = {
		limit = {
			X_province_estates_has_pmod_trigger = yes
		}
		X_province_estates_remove_all_pmod_effect = yes
	}
}

X_province_estates_on_development_effect = {
	[[development]
		if = {
			limit = { has_province_modifier = X_$estate$_province_control_pmod }
			owner = {
				change_estate_land_share = {
					estate = $estate$
					share = 0.1
				}
			}
		}
	]
	[[exploited]
		if = {
			limit = { has_province_modifier = X_$estate$_province_control_pmod }
			owner = {
				change_estate_land_share = {
					estate = $estate$
					share = -0.1
				}
			}
		}
	]
}

X_province_estates_remove_all_pmod_effect = {
	remove_province_modifier = X_estate_church_province_control_pmod
	remove_province_modifier = X_estate_burghers_province_control_pmod
	remove_province_modifier = X_estate_nobles_province_control_pmod
	remove_province_modifier = X_estate_dhimmi_province_control_pmod
}

X_province_estates_on_estate_removed_effect = {
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = X_$estate$_province_control_pmod
			}
			NOT = { has_estate = $estate$ }
		}
		every_owned_province = {
			limit = { has_province_modifier = X_$estate$_province_control_pmod }
			remove_province_modifier = X_$estate$_province_control_pmod
		}
	}
}

X_province_estates_grant_or_revoke_effect = {
	if = {
		limit = { owner = { has_estate = $estate$ } }
		if = {
			limit = { NOT = { has_province_modifier = X_$estate$_province_control_pmod } }
			custom_tooltip = X_province_estates_development_tt
			while = {
				limit = {
					check_variable = {
						which = X_province_estates_crownland_cost_variable
						value = 0.001
					}
				}
				owner = {
					change_estate_land_share = {
						estate = $estate$
						share = 0.001
					}
				}
				subtract_variable = {
					which = X_province_estates_crownland_cost_variable
					value = 0.001
				}
			}
			while = {
				limit = {
					check_variable = {
						which = X_province_estates_loyalty_variable
						value = 1
					}
				}
				owner = {
					add_estate_loyalty = {
						estate = $estate$
						loyalty = 1
					}
				}
				subtract_variable = {
					which = X_province_estates_loyalty_variable
					value = 1
				}
			}
			add_province_modifier = {
				name = X_$estate$_province_control_pmod
				duration = -1
			}
		}
		else = {
			limit = { has_province_modifier = X_$estate$_province_control_pmod owner = { has_estate = $estate$ } }
			custom_tooltip = X_province_estates_development_tt2
			while = {
				limit = {
					check_variable = {
						which = X_province_estates_crownland_cost_variable
						value = 0.001
					}
				}
				owner = {
					change_estate_land_share = {
						estate = $estate$
						share = -0.001
					}
				}
				subtract_variable = {
					which = X_province_estates_crownland_cost_variable
					value = 0.001
				}
			}
			while = {
				limit = {
					check_variable = {
						which = X_province_estates_loyalty_variable
						value = 1
					}
				}
				owner = {
					add_estate_loyalty = {
						estate = $estate$
						loyalty = -3
					}
				}
				subtract_variable = {
					which = X_province_estates_loyalty_variable
					value = 1
				}
			}
			remove_province_modifier = X_$estate$_province_control_pmod
		}
	}
}
